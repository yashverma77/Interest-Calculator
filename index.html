<!doctype html>
<html lang="en">
 <head>
    <link rel="icon" type="image/png" href="4.png">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Interest Calculator</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.95);
            --bg-input: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-color: #e2e8f0;
            --accent-primary: linear-gradient(135deg, #667eea, #764ba2);
            --accent-success: linear-gradient(135deg, #48bb78, #38a169);
            --shadow-light: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.15);
            --calc-bg: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            --bg-secondary: #2d3748;
            --bg-card: rgba(45, 55, 72, 0.95);
            --bg-input: #4a5568;
            --text-primary: #f7fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #a0aec0;
            --border-color: #4a5568;
            --accent-primary: linear-gradient(135deg, #667eea, #764ba2);
            --accent-success: linear-gradient(135deg, #48bb78, #38a169);
            --shadow-light: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.4);
            --calc-bg: linear-gradient(135deg, #2a4365 0%, #2c5282 100%);
        }

        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            min-height: 100%;
            color: var(--text-primary);
            overflow-x: hidden;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: var(--text-primary);
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
            color: var(--text-secondary);
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }
            
            .history-card {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
        }

        .calc-card {
            background: var(--calc-bg);
            backdrop-filter: blur(20px);
        }

        .results-card {
            background: linear-gradient(135deg, #f7fee7 0%, #ecfccb 100%);
            border: 1px solid #65a30d;
        }

        [data-theme="dark"] .results-card {
            background: linear-gradient(135deg, #365314 0%, #4d7c0f 100%);
            border: 1px solid #65a30d;
        }

        .history-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #0ea5e9;
        }

        [data-theme="dark"] .history-card {
            background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
            border: 1px solid #0ea5e9;
        }

        .card-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 28px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.025em;
        }

        .toggle-container {
            display: flex;
            background: var(--bg-input);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .toggle-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: var(--text-muted);
        }

        .toggle-btn.active {
            background: var(--accent-primary);
            color: white;
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.4);
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--text-secondary);
            font-size: 0.95rem;
            letter-spacing: -0.01em;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            font-size: 1.05rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-input);
            color: var(--text-primary);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.15);
            transform: translateY(-1px);
        }

        .principal-input {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: 700;
            color: var(--text-secondary);
            pointer-events: none;
        }

        .principal-input input {
            padding-left: 45px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
            font-weight: 700;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(79, 70, 229, 0.6);
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
            font-weight: 600;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .btn-success {
            background: var(--accent-success);
            color: white;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            font-weight: 700;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.6);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .results-card {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .results-card.show {
            opacity: 1;
            transform: translateY(0);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .result-item {
            background: var(--bg-input);
            padding: 24px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .result-label {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 12px;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .result-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .history-card {
            max-height: 600px;
            overflow-y: auto;
        }

        .history-item {
            background: var(--bg-input);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-light);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-mode {
            font-weight: 700;
            color: var(--text-primary);
        }

        .history-date {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .history-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #feb2b2;
            display: none;
        }

        .success-message {
            background: #c6f6d5;
            color: #2f855a;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #9ae6b4;
            display: none;
        }

        [data-theme="dark"] .error-message {
            background: #742a2a;
            color: #feb2b2;
            border-color: #c53030;
        }

        [data-theme="dark"] .success-message {
            background: #22543d;
            color: #9ae6b4;
            border-color: #38a169;
        }

        .duration-display {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            color: var(--text-primary);
            padding: 18px 24px;
            border-radius: 14px;
            margin: 20px 0;
            text-align: center;
            font-weight: 700;
            border: 2px solid rgba(102, 126, 234, 0.4);
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
            font-size: 1.05rem;
        }

        [data-theme="dark"] .duration-display {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.25) 0%, rgba(118, 75, 162, 0.25) 100%);
            border: 2px solid rgba(102, 126, 234, 0.5);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.25);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 24px;
                border-radius: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .button-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .theme-toggle {
                position: static;
                margin: 0 auto 20px;
                width: fit-content;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .toggle-container {
                flex-direction: column;
                gap: 8px;
            }
            
            .toggle-btn {
                padding: 14px 18px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .card {
                padding: 20px;
                border-radius: 16px;
            }
            
            .card-title {
                font-size: 1.3rem;
            }
            
            .result-value {
                font-size: 1.6rem;
            }
            
            .form-input, .form-select {
                padding: 14px 16px;
                font-size: 1rem;
            }
            
            .btn {
                padding: 16px 24px;
                font-size: 1rem;
            }
            
            .principal-input input {
                padding-left: 40px;
            }
            
            .currency-symbol {
                left: 16px;
            }
        }

        .frequency-group {
            display: none;
        }

        .frequency-group.show {
            display: block;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-primary);
            color: var(--bg-card);
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            color: var(--text-primary);
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            position: relative;
            transition: all 0.3s ease;
        }

        .radio-option input[type="radio"]:checked + .radio-custom {
            border-color: #4f46e5;
            background: #4f46e5;
        }

        .radio-option input[type="radio"]:checked + .radio-custom::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body data-theme="light">
  <div class="container">
   <header class="header">
    <div class="theme-toggle" onclick="toggleTheme()"><span id="theme-icon">üåô</span> <span id="theme-text">Dark Mode</span>
    </div>
    <h1 id="app-title">Advanced Interest Calculator</h1>
    <p id="subtitle">Calculate Simple &amp; Compound Interest with History</p>
   </header>
   <div class="dashboard"><!-- Input Card -->
    <div class="card calc-card">
     <h2 class="card-title">üí∞ Calculator Input 
      <div class="tooltip">
       ‚ÑπÔ∏è <span class="tooltiptext">Enter your investment details to calculate interest earnings</span>
      </div></h2>
     <div class="toggle-container"><button class="toggle-btn active" id="siBtn">Simple Interest</button> <button class="toggle-btn" id="ciBtn">Compound Interest</button>
     </div>
     <div class="error-message" id="errorMessage"></div>
     <form id="calculatorForm">
      <div class="form-group"><label for="principal" class="form-label">Principal Amount</label>
       <input type="number" inputmode="decimal" min="0" id="principal" class="form-input" placeholder="Enter amount (e.g., 100000)" required>

      </div>
      <div class="form-group"><label class="form-label">Interest Rate Type</label>
       <div class="radio-group"><label class="radio-option"> <input type="radio" name="rateType" value="annual"> <span class="radio-custom"></span> Annual Rate (%) </label> <label class="radio-option"> <input type="radio" name="rateType" value="monthly" checked> <span class="radio-custom"></span> Monthly Rate (%) </label>
       </div>
      </div>
      <div class="form-group"><label for="rate" class="form-label" id="rateLabel">Monthly Interest Rate (%)</label> <input type="number" id="rate" class="form-input" placeholder="Enter monthly rate (e.g., 0.7)" min="0.01" step="0.01" required>
      </div>
      <div class="form-group"><label class="form-label">Investment Period</label>
       <div class="form-row">
        <div><label for="startDate" class="form-label">Start Date</label> <input type="date" id="startDate" class="form-input" required>
        </div>
        <div><label for="endDate" class="form-label">End Date</label> <input type="date" id="endDate" class="form-input" required>
        </div>
       </div>
      </div>
      <div id="durationDisplay" class="duration-display" style="display: none;"></div>
      <div class="form-group frequency-group" id="frequencyGroup"><label for="frequency" class="form-label">Compounding Frequency 
        <div class="tooltip">
         ‚ÑπÔ∏è <span class="tooltiptext">How often interest is calculated and added to principal</span>
        </div></label> <select id="frequency" class="form-select"> <option value="1">Annually (Once per year)</option> <option value="2">Semi-Annually (Twice per year)</option> <option value="4">Quarterly (4 times per year)</option> <option value="12">Monthly (12 times per year)</option> <option value="365">Daily (365 times per year)</option> </select>
      </div>
      <div class="button-group"><button type="submit" class="btn btn-primary" id="calculateBtn"> üìä <span id="calculate-button-text">Calculate Interest</span> </button> <button type="button" class="btn btn-secondary" id="clearBtn"> üóëÔ∏è <span id="clear-button-text">Clear All</span> </button>
      </div>
     </form>
     <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Calculating...</p>
     </div>
    </div><!-- Results Card -->
    <div class="card results-card" id="resultsCard">
     <h2 class="card-title">üìà Calculation Results</h2>
     <div class="results-grid">
      <div class="result-item">
       <div class="result-label">
        Principal Amount
       </div>
       <div class="result-value" id="resultPrincipal">
        ‚Çπ0
       </div>
      </div>
      <div class="result-item">
       <div class="result-label">
        Interest Amount
       </div>
       <div class="result-value" id="resultInterest">
        ‚Çπ0
       </div>
      </div>
      <div class="result-item">
       <div class="result-label">
        Total Amount
       </div>
       <div class="result-value" id="resultTotal">
        ‚Çπ0
       </div>
      </div>
     </div>
     <div class="success-message" id="successMessage"></div>
     <div class="button-group"><button type="button" class="btn btn-success" id="downloadBtn"> üìÑ <span id="download-button-text">Download PDF</span> </button>
     </div>
    </div><!-- History Card -->
    <div class="card history-card">
     <h2 class="card-title">üìö Calculation History <button class="btn btn-secondary btn-small" id="clearHistoryBtn">Clear History</button></h2>
     <div id="historyList">
      <p style="text-align: center; color: var(--text-muted); padding: 20px;">No calculations yet. Start by calculating interest!</p>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Configuration object for editable elements
        const defaultConfig = {
            app_title: "Advanced Interest Calculator",
            subtitle: "Calculate Simple & Compound Interest with History",
            calculate_button: "Calculate Interest",
            clear_button: "Clear All",
            download_button: "Download PDF"
        };

        // Global variables
        let currentMode = 'SI';
        let lastCalculation = null;
        let calculationHistory = [];

        // Load history from localStorage
        function loadHistory() {
            try {
                const saved = localStorage.getItem('calculationHistory');
                calculationHistory = saved ? JSON.parse(saved) : [];
                renderHistory();
            } catch (error) {
                console.error('Error loading history:', error);
                calculationHistory = [];
            }
        }

        // Save history to localStorage
        function saveHistory() {
            try {
                localStorage.setItem('calculationHistory', JSON.stringify(calculationHistory));
            } catch (error) {
                console.error('Error saving history:', error);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadTheme();
            loadHistory();
        });

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig: defaultConfig,
                onConfigChange: async (config) => {
                    document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
                    document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
                    document.getElementById('calculate-button-text').textContent = config.calculate_button || defaultConfig.calculate_button;
                    document.getElementById('clear-button-text').textContent = config.clear_button || defaultConfig.clear_button;
                    document.getElementById('download-button-text').textContent = config.download_button || defaultConfig.download_button;
                },
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["app_title", config.app_title || defaultConfig.app_title],
                    ["subtitle", config.subtitle || defaultConfig.subtitle],
                    ["calculate_button", config.calculate_button || defaultConfig.calculate_button],
                    ["clear_button", config.clear_button || defaultConfig.clear_button],
                    ["download_button", config.download_button || defaultConfig.download_button]
                ])
            });
        }

        function initializeApp() {
            // Mode toggle functionality
            document.getElementById('siBtn').addEventListener('click', () => switchMode('SI'));
            document.getElementById('ciBtn').addEventListener('click', () => switchMode('CI'));

            // Form submission
            document.getElementById('calculatorForm').addEventListener('submit', handleCalculation);

            // Clear button with confirmation
            document.getElementById('clearBtn').addEventListener('click', confirmClearAll);

            // Download PDF button
            document.getElementById('downloadBtn').addEventListener('click', downloadPDF);

            // Clear history button with confirmation
            document.getElementById('clearHistoryBtn').addEventListener('click', confirmClearHistory);

            // Principal input formatting
            document.getElementById('principal').addEventListener('input', formatPrincipalInput);
            document.getElementById('principal').addEventListener('blur', formatPrincipalInput);

            // Rate type change handler
            document.querySelectorAll('input[name="rateType"]').forEach(radio => {
                radio.addEventListener('change', handleRateTypeChange);
            });

            // Date change listeners for duration calculation
            document.getElementById('startDate').addEventListener('change', calculateDuration);
            document.getElementById('endDate').addEventListener('change', calculateDuration);

            // Set default dates
            setDefaultDates();
        }

        function switchMode(mode) {
            currentMode = mode;
            
            // Update button states
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode === 'SI' ? 'siBtn' : 'ciBtn').classList.add('active');
            
            // Show/hide frequency group
            const frequencyGroup = document.getElementById('frequencyGroup');
            if (mode === 'CI') {
                frequencyGroup.classList.add('show');
            } else {
                frequencyGroup.classList.remove('show');
            }
        }

        function setDefaultDates() {
            const today = new Date();
            
            // Clear start date, set end date to today
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            calculateDuration();
        }

        function calculateDuration() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            if (startDate && endDate && endDate > startDate) {
                const diffTime = Math.abs(endDate - startDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const years = Math.floor(diffDays / 365);
                const months = Math.floor((diffDays % 365) / 30);
                const days = diffDays % 30;
                
                let durationText = `Duration: `;
                if (years > 0) durationText += `${years} year${years > 1 ? 's' : ''} `;
                if (months > 0) durationText += `${months} month${months > 1 ? 's' : ''} `;
                if (days > 0) durationText += `${days} day${days > 1 ? 's' : ''}`;
                
                document.getElementById('durationDisplay').textContent = durationText;
                document.getElementById('durationDisplay').style.display = 'block';
            } else {
                document.getElementById('durationDisplay').style.display = 'none';
            }
        }

        function handleRateTypeChange(e) {
            const rateLabel = document.getElementById('rateLabel');
            const rateInput = document.getElementById('rate');
            
            if (e.target.value === 'monthly') {
                rateLabel.textContent = 'Monthly Interest Rate (%)';
                rateInput.placeholder = 'Enter monthly rate (e.g., 0.7)';
            } else {
                rateLabel.textContent = 'Annual Interest Rate (%)';
                rateInput.placeholder = 'Enter annual rate (e.g., 8.5)';
            }
        }

        function confirmClearAll() {
            showConfirmDialog(
                'Clear All Fields',
                'Are you sure you want to clear all input fields and results? This action cannot be undone.',
                clearAll
            );
        }

        function confirmClearHistory() {
            if (calculationHistory.length === 0) {
                showError('No history to clear');
                return;
            }
            
            showConfirmDialog(
                'Clear History',
                `Are you sure you want to delete all ${calculationHistory.length} calculation${calculationHistory.length > 1 ? 's' : ''} from history? This action cannot be undone.`,
                clearHistory
            );
        }

        function showConfirmDialog(title, message, onConfirm) {
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                backdrop-filter: blur(4px);
            `;
            
            // Create modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: var(--bg-card);
                border-radius: 16px;
                padding: 24px;
                max-width: 400px;
                width: 90%;
                box-shadow: var(--shadow-hover);
                border: 1px solid var(--border-color);
            `;
            
            modal.innerHTML = `
                <h3 style="margin: 0 0 16px 0; color: var(--text-primary); font-size: 1.25rem; font-weight: 700;">${title}</h3>
                <p style="margin: 0 0 24px 0; color: var(--text-secondary); line-height: 1.5;">${message}</p>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelBtn" style="padding: 10px 20px; border: 2px solid var(--border-color); background: var(--bg-input); color: var(--text-secondary); border-radius: 8px; cursor: pointer; font-weight: 600;">Cancel</button>
                    <button id="confirmBtn" style="padding: 10px 20px; border: none; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">Confirm</button>
                </div>
            `;
            
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // Add event listeners
            modal.querySelector('#cancelBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            modal.querySelector('#confirmBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
                onConfirm();
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }

        function formatPrincipalInput(e) {
            let value = e.target.value.replace(/[^\d.]/g, '');
            if (value) {
                const parts = value.split('.');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                e.target.value = parts.join('.');
            }
        }

        function parsePrincipal(value) {
            return parseFloat(value.replace(/,/g, '')) || 0;
        }

        function handleCalculation(e) {
            e.preventDefault();
            
            if (!validateInputs()) {
                return;
            }
            
            showLoading(true);
            
            setTimeout(async () => {
                await performCalculation();
                showLoading(false);
            }, 800);
        }

        function validateInputs() {
            const principal = parsePrincipal(document.getElementById('principal').value);
            const rate = parseFloat(document.getElementById('rate').value);
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            let errors = [];
            
            if (!principal || principal <= 0) {
                errors.push('Principal amount must be greater than 0');
            }
            
            if (!rate || rate <= 0) {
                errors.push('Interest rate must be greater than 0');
            }
            
            if (!startDate || !endDate) {
                errors.push('Please select both start and end dates');
            } else if (endDate <= startDate) {
                errors.push('End date must be after start date');
            }
            
            if (errors.length > 0) {
                showError(errors.join('. '));
                return false;
            }
            
            hideError();
            return true;
        }

        async function performCalculation() {
            const principal = parsePrincipal(document.getElementById('principal').value);
            let rate = parseFloat(document.getElementById('rate').value);
            const rateType = document.querySelector('input[name="rateType"]:checked').value;
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const frequency = parseInt(document.getElementById('frequency').value);
            
            // Convert monthly rate to annual if needed
            if (rateType === 'monthly') {
                rate = rate * 12; // Convert monthly to annual
            }
            
            // Calculate time in years from dates
            const timeDiff = endDate - startDate;
            const timeInDays = timeDiff / (1000 * 60 * 60 * 24);
            const timeInYears = timeInDays / 365.25; // More accurate leap year calculation
            
            let interest, total;
            
            if (currentMode === 'SI') {
                // Simple Interest: SI = (P * R * T) / 100
                interest = (principal * rate * timeInYears) / 100;
                total = principal + interest;
            } else {
                // Compound Interest: A = P(1 + r/n)^(nt)
                const ratePerPeriod = rate / (100 * frequency);
                const totalPeriods = frequency * timeInYears;
                total = principal * Math.pow(1 + ratePerPeriod, totalPeriods);
                interest = total - principal;
            }
            
            // Round to 2 decimal places
            interest = Math.round(interest * 100) / 100;
            total = Math.round(total * 100) / 100;
            
            // Store calculation
            lastCalculation = {
                principal,
                rate: rateType === 'monthly' ? rate / 12 : rate, // Store original rate
                rateType,
                startDate: startDate.toISOString(),
                endDate: endDate.toISOString(),
                timeInYears: Math.round(timeInYears * 10000) / 10000,
                timeInDays: Math.round(timeInDays),
                mode: currentMode,
                frequency: currentMode === 'CI' ? frequency : 1,
                interest,
                total,
                timestamp: new Date().toISOString()
            };
            
            // Save to history
            if (calculationHistory.length < 999) {
                const historyItem = {
                    id: Date.now() + Math.random(), // Unique ID
                    principal: lastCalculation.principal,
                    rate: lastCalculation.rate,
                    rateType: lastCalculation.rateType,
                    startDate: lastCalculation.startDate,
                    endDate: lastCalculation.endDate,
                    timeInYears: lastCalculation.timeInYears,
                    timeInDays: lastCalculation.timeInDays,
                    mode: lastCalculation.mode,
                    frequency: lastCalculation.frequency,
                    interest: lastCalculation.interest,
                    total: lastCalculation.total,
                    timestamp: lastCalculation.timestamp
                };
                
                calculationHistory.unshift(historyItem); // Add to beginning
                saveHistory();
                renderHistory();
            } else {
                showError("Maximum limit of 999 calculations reached. Please clear some history first.");
            }
            
            // Display results
            displayResults(principal, interest, total);
        }

        function displayResults(principal, interest, total) {
            document.getElementById('resultPrincipal').textContent = `‚Çπ${formatNumber(principal)}`;
            document.getElementById('resultInterest').textContent = `‚Çπ${formatNumber(interest)}`;
            document.getElementById('resultTotal').textContent = `‚Çπ${formatNumber(total)}`;
            
            // Show results card with animation
            const resultsCard = document.getElementById('resultsCard');
            resultsCard.classList.add('show');
            
            // Show success message
            showSuccess(`${currentMode} calculation completed successfully!`);
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            
            if (calculationHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No calculations yet. Start by calculating interest!</p>';
                return;
            }
            
            historyList.innerHTML = calculationHistory.map(item => `
                <div class="history-item" onclick="loadCalculation('${item.id}')">
                    <div class="history-header">
                        <span class="history-mode">${item.mode} - ‚Çπ${formatNumber(item.total)}</span>
                        <span class="history-date">${new Date(item.timestamp).toLocaleDateString()}</span>
                    </div>
                    <div class="history-details">
                        Principal: ‚Çπ${formatNumber(item.principal)} | Rate: ${item.rate}% ${item.rateType || 'annual'} | 
                        Time: ${parseFloat(item.timeInYears).toFixed(2)} years${item.mode === 'CI' ? ` | ${getFrequencyText(parseInt(item.frequency))}` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getFrequencyText(frequency) {
            const frequencies = {
                1: 'Annually',
                2: 'Semi-Annually',
                4: 'Quarterly',
                12: 'Monthly',
                365: 'Daily'
            };
            return frequencies[frequency] || 'Custom';
        }

        function loadCalculation(id) {
            const calculation = calculationHistory.find(item => item.id == id);
            if (!calculation) return;
            
            // Load values into form
            document.getElementById('principal').value = formatNumber(calculation.principal);
            document.getElementById('rate').value = calculation.rate;
            
            // Set rate type
            const rateTypeRadio = document.querySelector(`input[name="rateType"][value="${calculation.rateType || 'annual'}"]`);
            if (rateTypeRadio) {
                rateTypeRadio.checked = true;
                handleRateTypeChange({ target: rateTypeRadio });
            }
            
            // Set dates
            if (calculation.startDate) {
                document.getElementById('startDate').value = calculation.startDate.split('T')[0];
            }
            if (calculation.endDate) {
                document.getElementById('endDate').value = calculation.endDate.split('T')[0];
            }
            
            document.getElementById('frequency').value = calculation.frequency;
            
            // Switch mode
            switchMode(calculation.mode);
            
            // Calculate duration
            calculateDuration();
            
            // Set last calculation
            lastCalculation = calculation;
            
            // Display results
            displayResults(calculation.principal, calculation.interest, calculation.total);
            
            showSuccess('Calculation loaded from history!');
        }

        function clearHistory() {
            if (calculationHistory.length === 0) {
                showError('No history to clear');
                return;
            }
            
            calculationHistory = [];
            saveHistory();
            renderHistory();
            
            showSuccess('History cleared successfully!');
        }

        function downloadPDF() {
            if (!lastCalculation) {
                showError('Please calculate interest first');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header with logo area
            doc.setFillColor(102, 126, 234);
            doc.rect(0, 0, 210, 40, 'F');
            
            // Title
            doc.setFontSize(24);
            doc.setTextColor(255, 255, 255);
            doc.setFont(undefined, 'bold');
            doc.text('INTEREST CALCULATION REPORT', 20, 25);
            
            // Subtitle
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`, 20, 35);
            
            // Reset colors for content
            doc.setTextColor(0, 0, 0);
            let yPos = 60;
            
            // Calculation Type Badge
            const calcType = lastCalculation.mode === 'SI' ? 'Simple Interest' : 'Compound Interest';
            doc.setFillColor(240, 248, 255);
            doc.roundedRect(20, yPos - 5, 80, 15, 3, 3, 'F');
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(102, 126, 234);
            doc.text(calcType, 25, yPos + 5);
            yPos += 30;
            
            // Investment Details Section
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text('Investment Details', 20, yPos);
            yPos += 5;
            
            // Draw line under section header
            doc.setDrawColor(200, 200, 200);
            doc.line(20, yPos, 190, yPos);
            yPos += 15;
            
            // Investment details in two columns
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            
            const leftColumn = [
                ['Principal Amount:', `Rs. ${lastCalculation.principal.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`],
                ['Interest Rate:', `${lastCalculation.rate}% ${lastCalculation.rateType || 'annual'}`],
                ['Start Date:', new Date(lastCalculation.startDate).toLocaleDateString()],
                ['End Date:', new Date(lastCalculation.endDate).toLocaleDateString()]
            ];
            
            const rightColumn = [
                ['Investment Period:', `${lastCalculation.timeInYears.toFixed(2)} years`],
                ['Total Days:', `${lastCalculation.timeInDays} days`],
                lastCalculation.mode === 'CI' ? ['Compounding:', getFrequencyText(lastCalculation.frequency)] : ['Calculation Type:', 'Simple Interest'],
                ['Report Date:', new Date().toLocaleDateString()]
            ];
            
            // Left column
            leftColumn.forEach(([label, value], index) => {
                doc.setFont(undefined, 'bold');
                doc.text(label, 20, yPos + (index * 12));
                doc.setFont(undefined, 'bold');
                doc.text(value, 70, yPos + (index * 12));
            });
            
            // Right column
            rightColumn.forEach(([label, value], index) => {
                if (label && value) {
                    doc.setFont(undefined, 'bold');
                    doc.text(label, 110, yPos + (index * 12));
                    doc.setFont(undefined, 'bold');
                    doc.text(value, 160, yPos + (index * 12));
                }
            });
            
            yPos += 70;
            
            // Results Section
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text('Calculation Results', 20, yPos);
            yPos += 5;
            
            // Draw line under section header
            doc.line(20, yPos, 190, yPos);
            yPos += 20;
            
            // Results boxes with enhanced styling
            const results = [
                { label: 'Principal Amount', value: `Rs. ${lastCalculation.principal.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, bgColor: [230, 240, 255], labelColor: [30, 64, 175], valueColor: [30, 64, 175] },
                { label: 'Interest Amount', value: `Rs. ${lastCalculation.interest.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, bgColor: [220, 252, 231], labelColor: [21, 128, 61], valueColor: [21, 128, 61] },
                { label: 'Total Amount', value: `Rs. ${lastCalculation.total.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, bgColor: [255, 237, 213], labelColor: [194, 65, 12], valueColor: [194, 65, 12] }
            ];
            
            results.forEach((result, index) => {
                const boxY = yPos + (index * 28);
                
                // Draw colored box with stronger background
                doc.setFillColor(...result.bgColor);
                doc.roundedRect(20, boxY - 5, 170, 24, 4, 4, 'F');
                
                // Add stronger border
                doc.setDrawColor(...result.labelColor);
                doc.setLineWidth(1.5);
                doc.roundedRect(20, boxY - 5, 170, 24, 4, 4, 'S');
                doc.setLineWidth(0.2); // Reset line width
                
                // Label - Bold and colored
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(...result.labelColor);
                doc.text(result.label, 25, boxY + 3);
                
                // Value - Larger, bold and colored
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(...result.valueColor);
                doc.text(result.value, 25, boxY + 15);
            });
            
            yPos += 100;
            
            // Additional spacing before footer
            yPos += 20;
            
            // Footer at the end
            doc.setFillColor(248, 250, 252);
            doc.rect(0, yPos - 10, 210, 25, 'F');
            doc.setFontSize(9);
            doc.setTextColor(100, 100, 100);
            doc.setFont(undefined, 'normal');
            doc.text('This report was generated by Advanced Interest Calculator', 20, yPos);
            doc.text(`Report ID: ${Date.now()}`, 20, yPos + 6);
            doc.text('For financial planning purposes only. Consult a financial advisor for investment decisions.', 20, yPos + 12);
            
            // Save the PDF
            const fileName = `Interest-Report-${new Date().toISOString().split('T')[0]}-${Date.now()}.pdf`;
            doc.save(fileName);
            
            showSuccess('Professional PDF report downloaded successfully!');
        }

        function clearAll() {
            // Clear form inputs
            document.getElementById('calculatorForm').reset();
            
            // Set end date to today after reset
            const today = new Date();
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            // Clear results
            document.getElementById('resultPrincipal').textContent = '‚Çπ0';
            document.getElementById('resultInterest').textContent = '‚Çπ0';
            document.getElementById('resultTotal').textContent = '‚Çπ0';
            
            // Hide results card
            document.getElementById('resultsCard').classList.remove('show');
            
            // Clear stored calculation
            lastCalculation = null;
            
            // Hide messages
            hideError();
            hideSuccess();
            
            // Hide duration display
            document.getElementById('durationDisplay').style.display = 'none';
            
            showSuccess('All fields cleared successfully!');
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            body.setAttribute('data-theme', newTheme);
            
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (newTheme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Light Mode';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Dark Mode';
            }
            
            localStorage.setItem('theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (savedTheme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Light Mode';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Dark Mode';
            }
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('calculateBtn').disabled = show;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(hideError, 5000);
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(hideSuccess, 3000);
        }

        function hideSuccess() {
            document.getElementById('successMessage').style.display = 'none';
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'993ae84ca59c5959',t:'MTc2MTMyMzk0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

